<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.17">
  <compounddef id="text__to__speech__node_8py" kind="file" language="Python">
    <compoundname>text_to_speech_node.py</compoundname>
    <innerclass refid="classtext__to__speech__node_1_1bcolors" prot="public">text_to_speech_node::bcolors</innerclass>
    <innerclass refid="classtext__to__speech__node_1_1TTS" prot="public">text_to_speech_node::TTS</innerclass>
    <innernamespace refid="namespacetext__to__speech__node">text_to_speech_node</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1" refid="namespacetext__to__speech__node" refkind="compound"><highlight class="comment">#!/usr/bin/env<sp/>python</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="comment">#<sp/>-*-<sp/>coding:<sp/>utf-8<sp/>-*-</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="5"><highlight class="stringliteral">This<sp/>node<sp/>listens<sp/>to<sp/>a<sp/>service<sp/>call<sp/>and<sp/>a<sp/>topic<sp/>for<sp/>text<sp/>to<sp/>speech</highlight></codeline>
<codeline lineno="6"><highlight class="stringliteral">requests.<sp/>These<sp/>will<sp/>be<sp/>processed<sp/>by<sp/>the<sp/>festival<sp/>or<sp/>the<sp/>philips<sp/>tts<sp/>module.</highlight></codeline>
<codeline lineno="7"><highlight class="stringliteral">&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>rospy</highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>os</highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>subprocess<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>Popen,<sp/>PIPE</highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>std_msgs.msg<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>String</highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>text_to_speech.srv<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>Speak,<sp/>SpeakRequest,<sp/>Play,<sp/>PlayRequest</highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>re</highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>sys</highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="19"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Python<sp/>2</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="20"><highlight class="normal"><sp/><sp/><sp/><sp/>reload(sys)</highlight></codeline>
<codeline lineno="21"><highlight class="normal"><sp/><sp/><sp/><sp/>sys.setdefaultencoding(</highlight><highlight class="stringliteral">&apos;utf8&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>(NameError,<sp/>AttributeError):</highlight></codeline>
<codeline lineno="23"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Python<sp/>3;<sp/>unicode<sp/>is<sp/>already<sp/>the<sp/>default</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="24"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">pass</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight></codeline>
<codeline lineno="27" refid="classtext__to__speech__node_1_1bcolors" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classtext__to__speech__node_1_1bcolors" kindref="compound">bcolors</ref>:</highlight></codeline>
<codeline lineno="28" refid="classtext__to__speech__node_1_1bcolors_1a2e4448618ce827a10ba1061cd970e0f5" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>HEADER<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;\033[95m&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="29" refid="classtext__to__speech__node_1_1bcolors_1a67a1934914f2c377c30b73b5d8be3b40" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>OKBLUE<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;\033[94m&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="30" refid="classtext__to__speech__node_1_1bcolors_1a5e2731a4197a16dc6aaa297d0b46ee8b" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>OKGREEN<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;\033[92m&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="31" refid="classtext__to__speech__node_1_1bcolors_1acffee83d7c0225cf004f0a1ca24d5ee7" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>WARNING<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;\033[93m&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="32" refid="classtext__to__speech__node_1_1bcolors_1a1312329a2c5f3149ad3d496334096803" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>FAIL<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;\033[91m&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="33" refid="classtext__to__speech__node_1_1bcolors_1a93a2be3706dae91732d3032e452bb70a" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>ENDC<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;\033[0m&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="34" refid="classtext__to__speech__node_1_1bcolors_1a862d68c58ce9eed46a92ae9106ad7ee8" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>BOLD<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;\033[1m&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="35" refid="classtext__to__speech__node_1_1bcolors_1a96a06277a76e44f373b8fb58295467c2" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>UNDERLINE<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;\033[4m&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="36"><highlight class="normal"></highlight></codeline>
<codeline lineno="37"><highlight class="normal"></highlight></codeline>
<codeline lineno="38" refid="classtext__to__speech__node_1_1TTS" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classtext__to__speech__node_1_1TTS" kindref="compound">TTS</ref>(object):</highlight></codeline>
<codeline lineno="39" refid="classtext__to__speech__node_1_1TTS_1a433e42519172d6e665ab4fcc5915060b" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtext__to__speech__node_1_1TTS_1a433e42519172d6e665ab4fcc5915060b" kindref="member">__init__</ref>(self,<sp/>tts_module,<sp/>executable=None,<sp/>key=None,<sp/>pitch=0):</highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>philips<sp/>specific<sp/>arguments</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="41" refid="classtext__to__speech__node_1_1TTS_1a852383b7006ff6a6d352a489fcf44a46" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtext__to__speech__node_1_1TTS_1a852383b7006ff6a6d352a489fcf44a46" kindref="member">executable</ref><sp/>=<sp/>executable</highlight></codeline>
<codeline lineno="42" refid="classtext__to__speech__node_1_1TTS_1a587e5d2cff4726c1826258765eb624e2" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtext__to__speech__node_1_1TTS_1a587e5d2cff4726c1826258765eb624e2" kindref="member">key</ref><sp/>=<sp/>key</highlight></codeline>
<codeline lineno="43" refid="classtext__to__speech__node_1_1TTS_1a8cfe114bb8cb5de85a96844ce5b1412f" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtext__to__speech__node_1_1TTS_1a8cfe114bb8cb5de85a96844ce5b1412f" kindref="member">pitch</ref><sp/>=<sp/>pitch</highlight></codeline>
<codeline lineno="44"><highlight class="normal"></highlight></codeline>
<codeline lineno="45" refid="classtext__to__speech__node_1_1TTS_1af9bf2f0d30b0073d82287da66b4573f3" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtext__to__speech__node_1_1TTS_1af9bf2f0d30b0073d82287da66b4573f3" kindref="member">character</ref><sp/>=<sp/>rospy.get_param(</highlight><highlight class="stringliteral">&quot;~character&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;Default&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="46" refid="classtext__to__speech__node_1_1TTS_1a65890e21da82a9a23a9b1e435631181f" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtext__to__speech__node_1_1TTS_1a65890e21da82a9a23a9b1e435631181f" kindref="member">language</ref><sp/>=<sp/>rospy.get_param(</highlight><highlight class="stringliteral">&quot;~language&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;us&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="47" refid="classtext__to__speech__node_1_1TTS_1ad3ec432d4870bc56a5d59ffd9b7510cf" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtext__to__speech__node_1_1TTS_1ad3ec432d4870bc56a5d59ffd9b7510cf" kindref="member">voice</ref><sp/>=<sp/>rospy.get_param(</highlight><highlight class="stringliteral">&quot;~voice&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;kyle&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="48" refid="classtext__to__speech__node_1_1TTS_1a08ab9c8c89341a9c0bf3952d466512f1" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtext__to__speech__node_1_1TTS_1a08ab9c8c89341a9c0bf3952d466512f1" kindref="member">emotion</ref><sp/>=<sp/>rospy.get_param(</highlight><highlight class="stringliteral">&quot;~emotion&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;Neutral&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="49" refid="classtext__to__speech__node_1_1TTS_1ab859e5639f21f49f061004b502cd80f9" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtext__to__speech__node_1_1TTS_1ab859e5639f21f49f061004b502cd80f9" kindref="member">samples_path</ref><sp/>=<sp/>rospy.get_param(</highlight><highlight class="stringliteral">&quot;~samples_path&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;~/MEGA/media/audio/soundboard&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="50"><highlight class="normal"></highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>topics</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="52" refid="classtext__to__speech__node_1_1TTS_1a039d8be4e60c3fd5a7d9944e285a8ebe" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtext__to__speech__node_1_1TTS_1a039d8be4e60c3fd5a7d9944e285a8ebe" kindref="member">sub_speak</ref><sp/>=<sp/>rospy.Subscriber(</highlight><highlight class="stringliteral">&quot;~input&quot;</highlight><highlight class="normal">,<sp/>String,<sp/>self.<ref refid="classtext__to__speech__node_1_1TTS_1ae7c4e8bf69a8c41d4dbd232f85d69dff" kindref="member">speak_topic</ref>)</highlight></codeline>
<codeline lineno="53" refid="classtext__to__speech__node_1_1TTS_1af84340495c7533512e0fdd0486f69228" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtext__to__speech__node_1_1TTS_1af84340495c7533512e0fdd0486f69228" kindref="member">pub_speak</ref><sp/>=<sp/>rospy.Publisher(</highlight><highlight class="stringliteral">&quot;~output&quot;</highlight><highlight class="normal">,<sp/>String,<sp/>queue_size=10)</highlight></codeline>
<codeline lineno="54"><highlight class="normal"></highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>services</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="56" refid="classtext__to__speech__node_1_1TTS_1a83313c473a5d3a32ebf4d08cc110be6d" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtext__to__speech__node_1_1TTS_1a83313c473a5d3a32ebf4d08cc110be6d" kindref="member">srv_speak</ref><sp/>=<sp/>rospy.Service(</highlight><highlight class="stringliteral">&apos;~speak&apos;</highlight><highlight class="normal">,<sp/>Speak,<sp/>self.<ref refid="classtext__to__speech__node_1_1TTS_1ab1bc1210ac65e03b219485dcb5f99f94" kindref="member">speak_srv</ref>)</highlight></codeline>
<codeline lineno="57"><highlight class="normal"></highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>clients</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="59" refid="classtext__to__speech__node_1_1TTS_1a20a353ab12abe829f752b9c6c1b1a73b" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtext__to__speech__node_1_1TTS_1a20a353ab12abe829f752b9c6c1b1a73b" kindref="member">client_play</ref><sp/>=<sp/>rospy.ServiceProxy(</highlight><highlight class="stringliteral">&apos;play&apos;</highlight><highlight class="normal">,<sp/>Play)</highlight></codeline>
<codeline lineno="60"><highlight class="normal"></highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>the<sp/>current<sp/>active<sp/>module<sp/>(philips<sp/>or<sp/>festival)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="62" refid="classtext__to__speech__node_1_1TTS_1ac0796106c30dc5b1e896be6d8d793df6" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtext__to__speech__node_1_1TTS_1ac0796106c30dc5b1e896be6d8d793df6" kindref="member">tts_module</ref><sp/>=<sp/>tts_module</highlight></codeline>
<codeline lineno="63"><highlight class="normal"></highlight></codeline>
<codeline lineno="64" refid="classtext__to__speech__node_1_1TTS_1adc18d29b13b0d6ecb5e068310b5bfbe7" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtext__to__speech__node_1_1TTS_1adc18d29b13b0d6ecb5e068310b5bfbe7" kindref="member">do_tts</ref>(self,<sp/>req):</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>req.sentence.strip():</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rospy.logwarn(</highlight><highlight class="stringliteral">&quot;Skipping<sp/>empty<sp/>sentence:<sp/>{}&quot;</highlight><highlight class="normal">.format(repr(req.sentence)))</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtext__to__speech__node_1_1TTS_1af84340495c7533512e0fdd0486f69228" kindref="member">pub_speak</ref>.publish(req.sentence)</highlight></codeline>
<codeline lineno="69"><highlight class="normal"></highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rospy.loginfo(</highlight><highlight class="stringliteral">&apos;TTS:<sp/>&quot;&apos;</highlight><highlight class="normal"><sp/>+<sp/>bcolors.OKBLUE<sp/>+<sp/>req.sentence<sp/>+<sp/>bcolors.ENDC<sp/>+<sp/></highlight><highlight class="stringliteral">&apos;&quot;&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rospy.loginfo(</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;TTS:<sp/>&apos;{0}&apos;<sp/>(module:<sp/>&apos;{1}&apos;,<sp/>character:<sp/>&apos;{2}&apos;,<sp/>language:<sp/>&apos;{3}&apos;,<sp/>voice:<sp/>&apos;{4}&apos;,<sp/>emotion:<sp/>&apos;{5}&apos;)&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.format(req.sentence,<sp/>self.<ref refid="classtext__to__speech__node_1_1TTS_1ac0796106c30dc5b1e896be6d8d793df6" kindref="member">tts_module</ref>,<sp/>req.character,<sp/>req.language,<sp/>req.voice,<sp/>req.emotion)</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="75"><highlight class="normal"></highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Check<sp/>if<sp/>an<sp/>audio<sp/>file<sp/>for<sp/>this<sp/>sentence<sp/>already<sp/>exists</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>extension<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>[</highlight><highlight class="stringliteral">&quot;wav&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;mp3&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;oga&quot;</highlight><highlight class="normal">]:</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>potential_filename<sp/>=<sp/>os.path.join(os.path.expanduser(self.<ref refid="classtext__to__speech__node_1_1TTS_1ab859e5639f21f49f061004b502cd80f9" kindref="member">samples_path</ref>),<sp/>req.sentence.lower()<sp/>+<sp/></highlight><highlight class="stringliteral">&quot;.&quot;</highlight><highlight class="normal"><sp/>+<sp/>extension)</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rospy.logdebug(</highlight><highlight class="stringliteral">&quot;Checking<sp/>for<sp/>file<sp/>on<sp/>path:<sp/>&quot;</highlight><highlight class="normal"><sp/>+<sp/>potential_filename)</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>os.path.isfile(potential_filename):</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rospy.logdebug(</highlight><highlight class="stringliteral">&quot;Found<sp/>file!&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>play_req<sp/>=<sp/>PlayRequest()</highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>play_req.audio_data<sp/>=<sp/>open(potential_filename,<sp/></highlight><highlight class="stringliteral">&quot;rb&quot;</highlight><highlight class="normal">).read()</highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>play_req.audio_type<sp/>=<sp/>extension</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>play_req.blocking_call<sp/>=<sp/>req.blocking_call</highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>play_req.pitch<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classtext__to__speech__node_1_1TTS_1a1f30c4defd306b8c362e8323e15d7767" kindref="member">play</ref>(play_req)</highlight></codeline>
<codeline lineno="88"><highlight class="normal"></highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>No<sp/>audio<sp/>sample<sp/>existed,<sp/>continuing<sp/>with<sp/>TTS</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>self.<ref refid="classtext__to__speech__node_1_1TTS_1ac0796106c30dc5b1e896be6d8d793df6" kindref="member">tts_module</ref><sp/>==<sp/></highlight><highlight class="stringliteral">&quot;philips&quot;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classtext__to__speech__node_1_1TTS_1a747714f331350f0638ed5861f248273d" kindref="member">do_tts_philips</ref>(req)</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classtext__to__speech__node_1_1TTS_1a4357d7e827032d71cc62125246975696" kindref="member">do_tts_festival</ref>(req)</highlight></codeline>
<codeline lineno="94"><highlight class="normal"></highlight></codeline>
<codeline lineno="95" refid="classtext__to__speech__node_1_1TTS_1a747714f331350f0638ed5861f248273d" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtext__to__speech__node_1_1TTS_1a747714f331350f0638ed5861f248273d" kindref="member">do_tts_philips</ref>(self,<sp/>req):</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>text<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;¬&lt;&quot;</highlight><highlight class="normal"><sp/>+<sp/>req.character<sp/>+<sp/></highlight><highlight class="stringliteral">&quot;&gt;&quot;</highlight><highlight class="normal"><sp/>+<sp/></highlight><highlight class="stringliteral">&apos;\n&apos;</highlight><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">#<sp/>Add<sp/>character</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>text<sp/>+=<sp/></highlight><highlight class="stringliteral">&quot;¬&lt;speaker=&quot;</highlight><highlight class="normal"><sp/>+<sp/>req.language<sp/>+<sp/></highlight><highlight class="stringliteral">&quot;_&quot;</highlight><highlight class="normal"><sp/>+<sp/>req.voice<sp/>+<sp/></highlight><highlight class="stringliteral">&quot;&gt;&quot;</highlight><highlight class="normal"><sp/>+<sp/></highlight><highlight class="stringliteral">&apos;\n&apos;</highlight><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">#<sp/>Add<sp/>language<sp/>+<sp/>voice</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>text<sp/>+=<sp/></highlight><highlight class="stringliteral">&quot;¬&lt;&quot;</highlight><highlight class="normal"><sp/>+<sp/>req.emotion<sp/>+<sp/></highlight><highlight class="stringliteral">&quot;&gt;&quot;</highlight><highlight class="normal"><sp/>+<sp/>req.sentence</highlight></codeline>
<codeline lineno="99"><highlight class="normal"></highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tmp_text_file<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;/tmp/temp_speech_text.txt&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="101"><highlight class="normal"></highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tts_file<sp/>=<sp/>file(tmp_text_file,<sp/></highlight><highlight class="stringliteral">&quot;w&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tts_file.write(text.encode(</highlight><highlight class="stringliteral">&quot;utf8&quot;</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tts_file.close()</highlight></codeline>
<codeline lineno="105"><highlight class="normal"></highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rospy.loginfo(</highlight><highlight class="stringliteral">&quot;File<sp/>created:<sp/>%s&quot;</highlight><highlight class="normal"><sp/>%<sp/>tmp_text_file)</highlight></codeline>
<codeline lineno="107"><highlight class="normal"></highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>save_name<sp/>=<sp/>re.sub(</highlight><highlight class="stringliteral">r&apos;(\W+|<sp/>)&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,<sp/>req.sentence)</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>save_name:</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>save_name<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;empty&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="111"><highlight class="normal"></highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>save_filename<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;/tmp/%s.wav&apos;</highlight><highlight class="normal"><sp/>%<sp/>save_name</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>command<sp/>=<sp/>self.<ref refid="classtext__to__speech__node_1_1TTS_1a852383b7006ff6a6d352a489fcf44a46" kindref="member">executable</ref><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;<sp/>-i<sp/>{0}<sp/>-k<sp/>&quot;</highlight><highlight class="normal">.format(tmp_text_file)<sp/>+<sp/>self.<ref refid="classtext__to__speech__node_1_1TTS_1a587e5d2cff4726c1826258765eb624e2" kindref="member">key</ref><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;<sp/>-o<sp/>{0}&quot;</highlight><highlight class="normal">.format(save_filename)</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rospy.loginfo(</highlight><highlight class="stringliteral">&quot;Executing<sp/>cmd:<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>command)</highlight></codeline>
<codeline lineno="115"><highlight class="normal"></highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p<sp/>=<sp/>Popen(command,<sp/>shell=</highlight><highlight class="keyword">True</highlight><highlight class="normal">,<sp/>stdout=PIPE,<sp/>stderr=PIPE)</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>stdout,<sp/>stderr<sp/>=<sp/>p.communicate()</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rc<sp/>=<sp/>p.returncode</highlight></codeline>
<codeline lineno="119"><highlight class="normal"></highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>rc<sp/>!=<sp/>0:</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>msg<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Return<sp/>code<sp/>TTS<sp/>Philips<sp/>!=<sp/>0:<sp/>{}&quot;</highlight><highlight class="normal">.format(stderr)</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rospy.logerr(msg)</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>msg</highlight></codeline>
<codeline lineno="124"><highlight class="normal"></highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rospy.loginfo(</highlight><highlight class="stringliteral">&quot;.wav<sp/>file<sp/>created:<sp/>{0}&quot;</highlight><highlight class="normal">.format(save_filename))</highlight></codeline>
<codeline lineno="126"><highlight class="normal"></highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>os.path.isfile(save_filename):</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>msg<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>create<sp/>wav<sp/>file<sp/>for<sp/>request:<sp/>{}&quot;</highlight><highlight class="normal">.format(req)</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rospy.logerr(msg)</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>msg</highlight></codeline>
<codeline lineno="131"><highlight class="normal"></highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Play<sp/>sound</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>play_req<sp/>=<sp/>PlayRequest()</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>play_req.audio_data<sp/>=<sp/>open(save_filename,<sp/></highlight><highlight class="stringliteral">&quot;rb&quot;</highlight><highlight class="normal">).read()</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>play_req.audio_type<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;wav&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>play_req.blocking_call<sp/>=<sp/>req.blocking_call</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>play_req.pitch<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classtext__to__speech__node_1_1TTS_1a1f30c4defd306b8c362e8323e15d7767" kindref="member">play</ref>(play_req)</highlight></codeline>
<codeline lineno="139"><highlight class="normal"></highlight></codeline>
<codeline lineno="140" refid="classtext__to__speech__node_1_1TTS_1a4357d7e827032d71cc62125246975696" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtext__to__speech__node_1_1TTS_1a4357d7e827032d71cc62125246975696" kindref="member">do_tts_festival</ref>(self,<sp/>req):</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>filename<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;/tmp/festival.wav&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="142"><highlight class="normal"></highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>command<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;echo<sp/>\&quot;%s\&quot;<sp/>|<sp/>text2wave<sp/>-o<sp/>%s&quot;</highlight><highlight class="normal"><sp/>%<sp/>(req.sentence,<sp/>filename)</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rospy.loginfo(command)</highlight></codeline>
<codeline lineno="145"><highlight class="normal"></highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p<sp/>=<sp/>Popen(command,<sp/>shell=</highlight><highlight class="keyword">True</highlight><highlight class="normal">,<sp/>stdout=PIPE,<sp/>stderr=PIPE)</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>stdout,<sp/>stderr<sp/>=<sp/>p.communicate()</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rc<sp/>=<sp/>p.returncode</highlight></codeline>
<codeline lineno="149"><highlight class="normal"></highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>stdout:</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rospy.logwarn(stdout)</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>rc<sp/>!=<sp/>0:</highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>msg<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Return<sp/>code<sp/>TTS<sp/>Festival<sp/>!=<sp/>0:<sp/>{}&quot;</highlight><highlight class="normal">.format(stderr<sp/></highlight><highlight class="keywordflow">or</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rospy.logerr(msg)</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>msg</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">elif</highlight><highlight class="normal"><sp/>stderr:</highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rospy.logerr(</highlight><highlight class="stringliteral">&quot;TTS<sp/>Festival:<sp/>{}&quot;</highlight><highlight class="normal">.format(stderr))</highlight></codeline>
<codeline lineno="158"><highlight class="normal"></highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Play<sp/>sound</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>play_req<sp/>=<sp/>PlayRequest()</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>play_req.audio_data<sp/>=<sp/>open(filename,<sp/></highlight><highlight class="stringliteral">&quot;rb&quot;</highlight><highlight class="normal">).read()</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>play_req.audio_type<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;wav&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>play_req.blocking_call<sp/>=<sp/>req.blocking_call</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>play_req.pitch<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classtext__to__speech__node_1_1TTS_1a1f30c4defd306b8c362e8323e15d7767" kindref="member">play</ref>(play_req)</highlight></codeline>
<codeline lineno="166"><highlight class="normal"></highlight></codeline>
<codeline lineno="167" refid="classtext__to__speech__node_1_1TTS_1a1f30c4defd306b8c362e8323e15d7767" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtext__to__speech__node_1_1TTS_1a1f30c4defd306b8c362e8323e15d7767" kindref="member">play</ref>(self,<sp/>play_req):</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>resp<sp/>=<sp/>self.<ref refid="classtext__to__speech__node_1_1TTS_1a20a353ab12abe829f752b9c6c1b1a73b" kindref="member">client_play</ref>(play_req)</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>resp.error_msg:</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>msg<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Could<sp/>not<sp/>play<sp/>sound:<sp/>{}&quot;</highlight><highlight class="normal">.format(resp.error_msg)</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rospy.logerr(msg)</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>msg</highlight></codeline>
<codeline lineno="173"><highlight class="normal"></highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>resp.error_msg</highlight></codeline>
<codeline lineno="175"><highlight class="normal"></highlight></codeline>
<codeline lineno="176" refid="classtext__to__speech__node_1_1TTS_1ae7c4e8bf69a8c41d4dbd232f85d69dff" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtext__to__speech__node_1_1TTS_1ae7c4e8bf69a8c41d4dbd232f85d69dff" kindref="member">speak_topic</ref>(self,<sp/>sentence_msg):</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>req<sp/>=<sp/>SpeakRequest()</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>req.sentence<sp/>=<sp/>sentence_msg.data</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>req.character<sp/>=<sp/>self.<ref refid="classtext__to__speech__node_1_1TTS_1af9bf2f0d30b0073d82287da66b4573f3" kindref="member">character</ref></highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>req.language<sp/>=<sp/>self.<ref refid="classtext__to__speech__node_1_1TTS_1a65890e21da82a9a23a9b1e435631181f" kindref="member">language</ref></highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>req.voice<sp/>=<sp/>self.<ref refid="classtext__to__speech__node_1_1TTS_1ad3ec432d4870bc56a5d59ffd9b7510cf" kindref="member">voice</ref></highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>req.emotion<sp/>=<sp/>self.<ref refid="classtext__to__speech__node_1_1TTS_1a08ab9c8c89341a9c0bf3952d466512f1" kindref="member">emotion</ref></highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>req.blocking_call<sp/>=<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rospy.logdebug(</highlight><highlight class="stringliteral">&quot;Topic:\n{}&quot;</highlight><highlight class="normal">.format(req))</highlight></codeline>
<codeline lineno="185"><highlight class="normal"></highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtext__to__speech__node_1_1TTS_1adc18d29b13b0d6ecb5e068310b5bfbe7" kindref="member">do_tts</ref>(req)</highlight></codeline>
<codeline lineno="187"><highlight class="normal"></highlight></codeline>
<codeline lineno="188" refid="classtext__to__speech__node_1_1TTS_1ab1bc1210ac65e03b219485dcb5f99f94" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtext__to__speech__node_1_1TTS_1ab1bc1210ac65e03b219485dcb5f99f94" kindref="member">speak_srv</ref>(self,<sp/>req):</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rospy.logdebug(</highlight><highlight class="stringliteral">&quot;Service:\n{}&quot;</highlight><highlight class="normal">.format(req))</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classtext__to__speech__node_1_1TTS_1adc18d29b13b0d6ecb5e068310b5bfbe7" kindref="member">do_tts</ref>(req)</highlight></codeline>
<codeline lineno="191"><highlight class="normal"></highlight></codeline>
<codeline lineno="192"><highlight class="normal"></highlight></codeline>
<codeline lineno="193"><highlight class="normal"></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>__name__<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;__main__&quot;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/>rospy.init_node(</highlight><highlight class="stringliteral">&apos;text_to_speech&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="195"><highlight class="normal"></highlight></codeline>
<codeline lineno="196" refid="namespacetext__to__speech__node_1a789be3b76ff2bb61f575dc82fefd4594" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>tts_module<sp/>=<sp/>rospy.get_param(</highlight><highlight class="stringliteral">&apos;~tts_module&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="197" refid="namespacetext__to__speech__node_1a99cde0c2f666b9a599d9d539ad85b448" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>pitch<sp/>=<sp/>rospy.get_param(</highlight><highlight class="stringliteral">&apos;~pitch&apos;</highlight><highlight class="normal">,<sp/>0)</highlight></codeline>
<codeline lineno="198" refid="namespacetext__to__speech__node_1a2b36aa6a428795fffe558d5c8b72b367" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>executable<sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="199" refid="namespacetext__to__speech__node_1afa13dac803195c23deec73c54b8831f5" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>key<sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="200"><highlight class="normal"></highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>tts_module<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;philips&quot;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>executable<sp/>=<sp/>rospy.get_param(</highlight><highlight class="stringliteral">&apos;~philips_executable&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>executable:</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rospy.logerr(</highlight><highlight class="stringliteral">&quot;text_to_speech_philips:<sp/>missing<sp/>parameter<sp/>&apos;philips_executable&apos;.&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Please<sp/>provide<sp/>the<sp/>location<sp/>of<sp/>the<sp/>executable<sp/>as<sp/>ROS<sp/>parameter.&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>exit(1)</highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>key<sp/>=<sp/>rospy.get_param(</highlight><highlight class="stringliteral">&apos;~key&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>key:</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rospy.logerr(</highlight><highlight class="stringliteral">&quot;text_to_speech_philips:<sp/>missing<sp/>parameter<sp/>&apos;key&apos;.&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Please<sp/>provide<sp/>the<sp/>Philips<sp/>key<sp/>as<sp/>ROS<sp/>parameter.&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>exit(1)</highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>remove<sp/>new<sp/>lines<sp/>from<sp/>the<sp/>key</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>key<sp/>=<sp/>key.rstrip(</highlight><highlight class="stringliteral">&apos;\n&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="214"><highlight class="normal"></highlight></codeline>
<codeline lineno="215" refid="namespacetext__to__speech__node_1a8ca71a4781be3b2f13d7d2c71950fffb" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>tts<sp/>=<sp/><ref refid="classtext__to__speech__node_1_1TTS" kindref="compound">TTS</ref>(tts_module,<sp/>executable,<sp/>key,<sp/>pitch)</highlight></codeline>
<codeline lineno="216"><highlight class="normal"></highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/>rospy.spin()</highlight></codeline>
    </programlisting>
    <location file="scripts/text_to_speech_node.py"/>
  </compounddef>
</doxygen>
