<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.17">
  <compounddef id="dragonfly__server_8py" kind="file" language="Python">
    <compoundname>dragonfly_server.py</compoundname>
    <innerclass refid="classdragonfly__speech__recognition_1_1dragonfly__server_1_1bcolors" prot="public">dragonfly_speech_recognition::dragonfly_server::bcolors</innerclass>
    <innerclass refid="classdragonfly__speech__recognition_1_1dragonfly__server_1_1DragonflyServer" prot="public">dragonfly_speech_recognition::dragonfly_server::DragonflyServer</innerclass>
    <innernamespace refid="namespacedragonfly__speech__recognition_1_1dragonfly__server">dragonfly_speech_recognition::dragonfly_server</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1" refid="namespacedragonfly__speech__recognition_1_1dragonfly__server" refkind="compound"><highlight class="comment">#!/usr/bin/env<sp/>python</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>logging</highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>multiprocessing.connection</highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>traceback</highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight></codeline>
<codeline lineno="6" refid="namespacedragonfly__speech__recognition_1_1dragonfly__server_1ac8abae8e2d95efdd930fa2e943714da7" refkind="member"><highlight class="normal">FORMAT<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;%(asctime)s<sp/>%(module)s<sp/>[%(levelname)s]<sp/>%(message)s&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="7" refid="namespacedragonfly__speech__recognition_1_1dragonfly__server_1afefd1dc2a87e48d05cffd41cbea5dc5e" refkind="member"><highlight class="normal">logging.basicConfig(format=FORMAT)</highlight></codeline>
<codeline lineno="8"><highlight class="normal">logging.getLogger().setLevel(logging.INFO)</highlight></codeline>
<codeline lineno="9" refid="namespacedragonfly__speech__recognition_1_1dragonfly__server_1af1f651a3d68a82f69878546d36da5a18" refkind="member"><highlight class="normal">logger<sp/>=<sp/>logging.getLogger(__name__)</highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="comment">#<sp/>Try<sp/>to<sp/>import<sp/>the<sp/>dragonfly<sp/>wrapper,<sp/>if<sp/>it<sp/>fails<sp/>(on<sp/>a<sp/>unix<sp/>machine),<sp/>use<sp/>the<sp/>stub<sp/>instead</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="13"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>.dragonfly_wrapper<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>DragonflyWrapper</highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>ImportError<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>e:</highlight></codeline>
<codeline lineno="15"><highlight class="normal"><sp/><sp/><sp/><sp/>logger.warning(f</highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>import<sp/>DragonflyWrapper:<sp/>&apos;{e}&apos;<sp/>using<sp/>stub<sp/>instead<sp/>...\n{traceback.format_exc()}&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="16"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>.dragonfly_wrapper_stub<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>DragonflyWrapper</highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight></codeline>
<codeline lineno="19" refid="classdragonfly__speech__recognition_1_1dragonfly__server_1_1bcolors" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classdragonfly__speech__recognition_1_1dragonfly__server_1_1bcolors" kindref="compound">bcolors</ref>:</highlight></codeline>
<codeline lineno="20" refid="classdragonfly__speech__recognition_1_1dragonfly__server_1_1bcolors_1a00b739b4ab896a21e3474aafe3577b5a" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>HEADER<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;\033[95m&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="21" refid="classdragonfly__speech__recognition_1_1dragonfly__server_1_1bcolors_1abbbfa645b1aba1e032f33888123ea87f" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>OKBLUE<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;\033[94m&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="22" refid="classdragonfly__speech__recognition_1_1dragonfly__server_1_1bcolors_1ade4f6e5ea98701b3c3470b3a2f81be9b" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>OKGREEN<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;\033[92m&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="23" refid="classdragonfly__speech__recognition_1_1dragonfly__server_1_1bcolors_1aafc801abe3115dad753ad9b11d6ab5ee" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>WARNING<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;\033[93m&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="24" refid="classdragonfly__speech__recognition_1_1dragonfly__server_1_1bcolors_1af743b6180e07193edacc57f170489b0b" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>FAIL<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;\033[91m&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="25" refid="classdragonfly__speech__recognition_1_1dragonfly__server_1_1bcolors_1aa44b87655d98f8e075c7ed0b7c03cc87" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>ENDC<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;\033[0m&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="26" refid="classdragonfly__speech__recognition_1_1dragonfly__server_1_1bcolors_1aa0a2878b0e4883ffe5a5c6e8e0242f8b" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>BOLD<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;\033[1m&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="27" refid="classdragonfly__speech__recognition_1_1dragonfly__server_1_1bcolors_1a64babf19100f8a44e2fab15c3cab7daa" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>UNDERLINE<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;\033[4m&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight></codeline>
<codeline lineno="30" refid="classdragonfly__speech__recognition_1_1dragonfly__server_1_1DragonflyServer" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classdragonfly__speech__recognition_1_1dragonfly__server_1_1DragonflyServer" kindref="compound">DragonflyServer</ref>:</highlight></codeline>
<codeline lineno="31" refid="classdragonfly__speech__recognition_1_1dragonfly__server_1_1DragonflyServer_1a4774ededcce7e2bce700017fc867c898" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classdragonfly__speech__recognition_1_1dragonfly__server_1_1DragonflyServer_1a4774ededcce7e2bce700017fc867c898" kindref="member">__init__</ref>(self,<sp/>ip,<sp/>port):</highlight></codeline>
<codeline lineno="32"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.info(</highlight><highlight class="stringliteral">&quot;Setting<sp/>up<sp/>DragonflyServer<sp/>{}:{}&quot;</highlight><highlight class="normal">.<ref refid="namespacedragonfly__speech__recognition_1_1dragonfly__server_1afefd1dc2a87e48d05cffd41cbea5dc5e" kindref="member">format</ref>(ip,<sp/>port))</highlight></codeline>
<codeline lineno="33" refid="classdragonfly__speech__recognition_1_1dragonfly__server_1_1DragonflyServer_1a15fe2f18292497201a18a480c4cd03dc" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classdragonfly__speech__recognition_1_1dragonfly__server_1_1DragonflyServer_1a15fe2f18292497201a18a480c4cd03dc" kindref="member">_listener</ref><sp/>=<sp/>multiprocessing.connection.Listener((ip,<sp/>port))</highlight></codeline>
<codeline lineno="34" refid="classdragonfly__speech__recognition_1_1dragonfly__server_1_1DragonflyServer_1abc87c57b9ee0d3a6d0dc4354b7e07aaa" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classdragonfly__speech__recognition_1_1dragonfly__server_1_1DragonflyServer_1abc87c57b9ee0d3a6d0dc4354b7e07aaa" kindref="member">_dragonfly_wrapper</ref><sp/>=<sp/><ref refid="classdragonfly__speech__recognition_1_1dragonfly__wrapper_1_1DragonflyWrapper" kindref="compound">DragonflyWrapper</ref>()</highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight></codeline>
<codeline lineno="36" refid="classdragonfly__speech__recognition_1_1dragonfly__server_1_1DragonflyServer_1a47f9f53f741c855562f534c7d1cc010c" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classdragonfly__speech__recognition_1_1dragonfly__server_1_1DragonflyServer_1a47f9f53f741c855562f534c7d1cc010c" kindref="member">spin</ref>(self):</highlight></codeline>
<codeline lineno="37"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.info(</highlight><highlight class="stringliteral">&quot;Spinning<sp/>....&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>conn<sp/>=<sp/>self.<ref refid="classdragonfly__speech__recognition_1_1dragonfly__server_1_1DragonflyServer_1a15fe2f18292497201a18a480c4cd03dc" kindref="member">_listener</ref>.accept()</highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classdragonfly__speech__recognition_1_1dragonfly__server_1_1DragonflyServer_1a261a9d6c78cadc0779f4d277a972dbf1" kindref="member">_process_connection</ref>(conn)</highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>KeyboardInterrupt:</highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.warning(</highlight><highlight class="stringliteral">&apos;keyboard<sp/>interrupt&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>Exception<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>e:</highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.exception(f</highlight><highlight class="stringliteral">&apos;Speech<sp/>exception:<sp/>{e}\n{traceback.format_exc()}&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="47"><highlight class="normal"></highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>conn.close()</highlight></codeline>
<codeline lineno="49"><highlight class="normal"></highlight></codeline>
<codeline lineno="50" refid="classdragonfly__speech__recognition_1_1dragonfly__server_1_1DragonflyServer_1a261a9d6c78cadc0779f4d277a972dbf1" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classdragonfly__speech__recognition_1_1dragonfly__server_1_1DragonflyServer_1a261a9d6c78cadc0779f4d277a972dbf1" kindref="member">_process_connection</ref>(self,<sp/>conn):</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>parse<sp/>command</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cmd<sp/>=<sp/>conn.recv()</highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>cmd<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;restart_node&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.warning(</highlight><highlight class="stringliteral">&apos;restarting<sp/>node<sp/>now!!!&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>exit(1)</highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>grammar,<sp/>target<sp/>=<sp/>cmd</highlight></codeline>
<codeline lineno="57"><highlight class="normal"></highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.info(</highlight><highlight class="stringliteral">&apos;Connection<sp/>accepted<sp/>from<sp/>{}<sp/>::<sp/>Target:<sp/>{}&apos;</highlight><highlight class="normal">.<ref refid="namespacedragonfly__speech__recognition_1_1dragonfly__server_1afefd1dc2a87e48d05cffd41cbea5dc5e" kindref="member">format</ref>(self.<ref refid="classdragonfly__speech__recognition_1_1dragonfly__server_1_1DragonflyServer_1a15fe2f18292497201a18a480c4cd03dc" kindref="member">_listener</ref>.last_accepted,<sp/>target))</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.debug(</highlight><highlight class="stringliteral">&quot;Grammar:<sp/>{}&quot;</highlight><highlight class="normal">.<ref refid="namespacedragonfly__speech__recognition_1_1dragonfly__server_1afefd1dc2a87e48d05cffd41cbea5dc5e" kindref="member">format</ref>(grammar))</highlight></codeline>
<codeline lineno="60"><highlight class="normal"></highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classdragonfly__speech__recognition_1_1dragonfly__server_1_1DragonflyServer_1abc87c57b9ee0d3a6d0dc4354b7e07aaa" kindref="member">_dragonfly_wrapper</ref>.set_grammar(grammar,<sp/>target)</highlight></codeline>
<codeline lineno="62"><highlight class="normal"></highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>conn.poll(.1):<sp/><sp/></highlight><highlight class="comment">#<sp/>We<sp/>have<sp/>received<sp/>a<sp/>cancel<sp/>request</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classdragonfly__speech__recognition_1_1dragonfly__server_1_1DragonflyServer_1abc87c57b9ee0d3a6d0dc4354b7e07aaa" kindref="member">_dragonfly_wrapper</ref>.unset_grammar()</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>recognition<sp/>=<sp/>self.<ref refid="classdragonfly__speech__recognition_1_1dragonfly__server_1_1DragonflyServer_1abc87c57b9ee0d3a6d0dc4354b7e07aaa" kindref="member">_dragonfly_wrapper</ref>.get_recognition()</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>recognition<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logging.info(</highlight><highlight class="stringliteral">&quot;Sending<sp/>result<sp/>back<sp/>to<sp/>the<sp/>client:<sp/>\x1b[;44m&apos;%s&apos;\x1b[0m&quot;</highlight><highlight class="normal">,<sp/>recognition)</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classdragonfly__speech__recognition_1_1dragonfly__server_1_1DragonflyServer_1abc87c57b9ee0d3a6d0dc4354b7e07aaa" kindref="member">_dragonfly_wrapper</ref>.unset_grammar()</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>conn.send(recognition)</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal"></highlight></codeline>
    </programlisting>
    <location file="src/dragonfly_speech_recognition/dragonfly_server.py"/>
  </compounddef>
</doxygen>
