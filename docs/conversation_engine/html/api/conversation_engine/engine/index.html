

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>conversation_engine.engine &mdash; conversation_engine 0.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=eafc0fe6" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=525cde36"></script>
      <script src="../../../_static/doctools.js?v=888ff710"></script>
      <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="prev" title="conversation_engine" href="../index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            conversation_engine
              <img src="../../../_static/techunited.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">API Reference</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">conversation_engine</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">conversation_engine.engine</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">conversation_engine</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">API Reference</a></li>
          <li class="breadcrumb-item"><a href="../index.html">conversation_engine</a></li>
      <li class="breadcrumb-item active">conversation_engine.engine</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/api/conversation_engine/engine/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-conversation_engine.engine">
<span id="conversation-engine-engine"></span><h1>conversation_engine.engine<a class="headerlink" href="#module-conversation_engine.engine" title="Permalink to this heading"></a></h1>
<section id="classes">
<h2>Classes<a class="headerlink" href="#classes" title="Permalink to this heading"></a></h2>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#conversation_engine.engine.ConversationState" title="conversation_engine.engine.ConversationState"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ConversationState</span></code></a></p></td>
<td><p>Encapsulate all conversation state.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#conversation_engine.engine.ConversationEngine" title="conversation_engine.engine.ConversationEngine"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ConversationEngine</span></code></a></p></td>
<td><p>ConversationEngine provides the bridge between the user and the action_server.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#conversation_engine.engine.ConversationEngineUsingTopic" title="conversation_engine.engine.ConversationEngineUsingTopic"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ConversationEngineUsingTopic</span></code></a></p></td>
<td><p>ConversationEngine provides the bridge between the user and the action_server.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="functions">
<h2>Functions<a class="headerlink" href="#functions" title="Permalink to this heading"></a></h2>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#conversation_engine.engine.sanitize_text" title="conversation_engine.engine.sanitize_text"><code class="xref py py-obj docutils literal notranslate"><span class="pre">sanitize_text</span></code></a>(txt)</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#conversation_engine.engine.describe_current_subtask" title="conversation_engine.engine.describe_current_subtask"><code class="xref py py-obj docutils literal notranslate"><span class="pre">describe_current_subtask</span></code></a>(subtask[, prefix])</p></td>
<td><p>Make a 'natural' language description of subtask name</p></td>
</tr>
</tbody>
</table>
</section>
<section id="module-contents">
<h2>Module Contents<a class="headerlink" href="#module-contents" title="Permalink to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="conversation_engine.engine.sanitize_text">
<span class="sig-prename descclassname"><span class="pre">conversation_engine.engine.</span></span><span class="sig-name descname"><span class="pre">sanitize_text</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">txt</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#conversation_engine.engine.sanitize_text" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="conversation_engine.engine.describe_current_subtask">
<span class="sig-prename descclassname"><span class="pre">conversation_engine.engine.</span></span><span class="sig-name descname"><span class="pre">describe_current_subtask</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">subtask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#conversation_engine.engine.describe_current_subtask" title="Permalink to this definition"></a></dt>
<dd><p>Make a ‘natural’ language description of subtask name</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationState">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">conversation_engine.engine.</span></span><span class="sig-name descname"><span class="pre">ConversationState</span></span><a class="headerlink" href="#conversation_engine.engine.ConversationState" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3.8/library/functions.html#object" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Encapsulate all conversation state.
This makes it impossible to transition to a next state without setting the correct fields</p>
<p>When a new conversation is started, the ConversationState is IDLE.
Then the user can initiate the conversation by supplying text, which then initializes the semantics of an action.
The ConversationEngine then sends this to the action_server and we wait for the robot to execute the action or
think about why the action cannot be performed yet.
When calling the action_server, we must indicate that we are waiting for the robot via the the wait_for_robot()
method.</p>
<p>In the case of missing info, the robot misses some field from the semantics.
The ConversationEngine figures out which subtree of the grammar to use to parse the user’s eventual input and
passes this in the wait_for_user() method.
The missing field can, for example, be a location to do something with.
This means the grammar should not try to parse the reply to come as a type of drink or as a verb, for example, but
as a location.
What rule to parse text with is stored in .target</p>
<p>The ConversationEngine then says something to the user and waits for the user to reply.
When this is received, the ConversationEngine reads the grammar target from the ConversationState before it parses
the replied text for additional info.</p>
<p>The current semantics are updated using update_semantics() and the action_server is called again with the now
updated semantics.
When this happens, the ConversationEngine must call wait_for_robot() again.</p>
<p>The user can also ask to abort() the conversation to stop.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationState.IDLE">
<span class="sig-name descname"><span class="pre">IDLE</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'IDLE'</span></em><a class="headerlink" href="#conversation_engine.engine.ConversationState.IDLE" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationState.WAIT_FOR_USER">
<span class="sig-name descname"><span class="pre">WAIT_FOR_USER</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'WAIT_FOR_USER'</span></em><a class="headerlink" href="#conversation_engine.engine.ConversationState.WAIT_FOR_USER" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationState.WAIT_FOR_ROBOT">
<span class="sig-name descname"><span class="pre">WAIT_FOR_ROBOT</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'WAIT_FOR_ROBOT'</span></em><a class="headerlink" href="#conversation_engine.engine.ConversationState.WAIT_FOR_ROBOT" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationState.ABORTING">
<span class="sig-name descname"><span class="pre">ABORTING</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'ABORTING'</span></em><a class="headerlink" href="#conversation_engine.engine.ConversationState.ABORTING" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationState._state">
<span class="sig-name descname"><span class="pre">_state</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'IDLE'</span></em><a class="headerlink" href="#conversation_engine.engine.ConversationState._state" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationState._target">
<span class="sig-name descname"><span class="pre">_target</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#conversation_engine.engine.ConversationState._target" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationState._missing_field">
<span class="sig-name descname"><span class="pre">_missing_field</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#conversation_engine.engine.ConversationState._missing_field" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationState._current_semantics">
<span class="sig-name descname"><span class="pre">_current_semantics</span></span><a class="headerlink" href="#conversation_engine.engine.ConversationState._current_semantics" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationState.state">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">state</span></span><a class="headerlink" href="#conversation_engine.engine.ConversationState.state" title="Permalink to this definition"></a></dt>
<dd><p>Part of the conversation we’re in</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationState.target">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">target</span></span><a class="headerlink" href="#conversation_engine.engine.ConversationState.target" title="Permalink to this definition"></a></dt>
<dd><p>Subtree of the grammar tree to use when parsing text</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationState.missing_field">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">missing_field</span></span><a class="headerlink" href="#conversation_engine.engine.ConversationState.missing_field" title="Permalink to this definition"></a></dt>
<dd><p>What field is missing in the current_semantics before the action_server can execute it
The user must provide useful information to fill this field.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationState.current_semantics">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">current_semantics</span></span><a class="headerlink" href="#conversation_engine.engine.ConversationState.current_semantics" title="Permalink to this definition"></a></dt>
<dd><p>A dict containing an (incomplete) action description for the action_server</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationState.wait_for_user">
<span class="sig-name descname"><span class="pre">wait_for_user</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">missing_field</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#conversation_engine.engine.ConversationState.wait_for_user" title="Permalink to this definition"></a></dt>
<dd><p>Indicate that the ConversationEngine is waiting for the user’s input.</p>
<p>This is to wait for additional info, that must be parsed according to target in order to fill some missing field</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>target</strong> (<a class="reference external" href="https://docs.python.org/3.8/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – name of the grammar rule to parse the user’s reply with</p></li>
<li><p><strong>missing_field</strong> – a ‘path’ indicating where to insert the additional info from the user into the</p></li>
</ul>
</dd>
</dl>
<p>current_semantics dictionary
:type missing_field: str</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationState.wait_for_robot">
<span class="sig-name descname"><span class="pre">wait_for_robot</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#conversation_engine.engine.ConversationState.wait_for_robot" title="Permalink to this definition"></a></dt>
<dd><p>Indicate that the ConversationEngine is waiting for the robot to either finish (planning) the action</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationState.aborting">
<span class="sig-name descname"><span class="pre">aborting</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timeout</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeout_callback</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#conversation_engine.engine.ConversationState.aborting" title="Permalink to this definition"></a></dt>
<dd><p>Set the state to ABORTING. If the action server hasn’t aborted the action after the given timeout,
call the callback to deal with that</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>timeout</strong> (<em>rospy.Duration</em>) – duration to wait before killing</p></li>
<li><p><strong>timeout_callback</strong> (<em>(</em><em>event: rospy.TimerEvent</em><em>)</em>) – callback is called when the aborting takes too long</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationState.initialize_semantics">
<span class="sig-name descname"><span class="pre">initialize_semantics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">semantics</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#conversation_engine.engine.ConversationState.initialize_semantics" title="Permalink to this definition"></a></dt>
<dd><p>Initialize an action description for the action_server. This gets updated as the conversation progresses, via
update_semantics()</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationState.update_semantics">
<span class="sig-name descname"><span class="pre">update_semantics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">semantics</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">missing_field_path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#conversation_engine.engine.ConversationState.update_semantics" title="Permalink to this definition"></a></dt>
<dd><p>Update the current action description for the action_server</p>
<p>The semantics will be filled into current_semantics at the missing_field_path</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>semantics</strong> (<a class="reference external" href="https://docs.python.org/3.8/library/stdtypes.html#dict" title="(in Python v3.8)"><em>dict</em></a>) – dictionary with additional info</p></li>
<li><p><strong>missing_field_path</strong> – a ‘path’ indicating where to insert the additional info from the user into the</p></li>
</ul>
</dd>
</dl>
<p>current_semantics dictionary
:type missing_field_path: str</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationEngine">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">conversation_engine.engine.</span></span><span class="sig-name descname"><span class="pre">ConversationEngine</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">action_client</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grammar</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">command_target</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">give_examples</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#conversation_engine.engine.ConversationEngine" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3.8/library/functions.html#object" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>ConversationEngine provides the bridge between the user and the action_server.</p>
<p>It accepts text and parses it to a ‘semantics’ dictionary that the action_server can interpret.</p>
<p>The action_server then tries to formulate a plan based on the semantics and either:
- starts execution and succeeds or fails
- indicates it is missing information.
In the case of missing information, the action_server indicates what field of information it is missing.</p>
<p>Based on that, the ConversationEngine must converse with the user to obtain more information.
There is some logic to determine with grammar rules/target to use to parse the additional information with.</p>
<p>Once the information is obtained, the semantics of the current conversation state are updated
and sent to the action_server again, in hope the semantics is now complete enough for execution.</p>
<p>ConversationEngine is set up as a base class, that leaves the implementation of talking with the user to subclasses.
Implement
- _say_to_user to say something to the user
- user_to_robot_text to accept text from the user</p>
<p>Initialize a new ConversationEngine for the given robot, using some grammar with a command_target.
Indicate whether to give examples of thins to say to the user via give_examples</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>action_client</strong> (<em>Client</em>) – interface to the action server</p></li>
<li><p><strong>grammar</strong> (<a class="reference external" href="https://docs.python.org/3.8/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – <p>string to initialize a CFGParser with see <a class="reference external" href="https://github.com/tue-robotics/grammar_parser/">https://github.com/tue-robotics/grammar_parser/</a>
The grammar must result in an action description dictionary, like
{‘actions’: [{‘action’: ‘hand-over’,</p>
<blockquote>
<div><p>’object’: {‘type’: ‘drink’},
‘target-location’: {‘type’: ‘person’, ‘id’: ‘operator’}}]}</p>
</div></blockquote>
</p></li>
<li><p><strong>command_target</strong> (<a class="reference external" href="https://docs.python.org/3.8/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – the root of the grammar’s parse tree</p></li>
<li><p><strong>give_examples</strong> (<a class="reference external" href="https://docs.python.org/3.8/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a>) – Include examples when talking with the user.
These are randomly generated from the active part of the grammar</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationEngine._state">
<span class="sig-name descname"><span class="pre">_state</span></span><a class="headerlink" href="#conversation_engine.engine.ConversationEngine._state" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationEngine._action_client">
<span class="sig-name descname"><span class="pre">_action_client</span></span><a class="headerlink" href="#conversation_engine.engine.ConversationEngine._action_client" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationEngine._parser">
<span class="sig-name descname"><span class="pre">_parser</span></span><a class="headerlink" href="#conversation_engine.engine.ConversationEngine._parser" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationEngine._grammar">
<span class="sig-name descname"><span class="pre">_grammar</span></span><a class="headerlink" href="#conversation_engine.engine.ConversationEngine._grammar" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationEngine._command_target">
<span class="sig-name descname"><span class="pre">_command_target</span></span><a class="headerlink" href="#conversation_engine.engine.ConversationEngine._command_target" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationEngine.give_examples">
<span class="sig-name descname"><span class="pre">give_examples</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">True</span></em><a class="headerlink" href="#conversation_engine.engine.ConversationEngine.give_examples" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationEngine._latest_feedback">
<span class="sig-name descname"><span class="pre">_latest_feedback</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#conversation_engine.engine.ConversationEngine._latest_feedback" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationEngine.user_to_robot_text">
<span class="sig-name descname"><span class="pre">user_to_robot_text</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">text</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#conversation_engine.engine.ConversationEngine.user_to_robot_text" title="Permalink to this definition"></a></dt>
<dd><p>Accept raw text from the user.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>text</strong> – what the user typed or said</p>
</dd>
</dl>
<p>:type text str</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationEngine._handle_user_to_robot">
<span class="sig-name descname"><span class="pre">_handle_user_to_robot</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">text</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#conversation_engine.engine.ConversationEngine._handle_user_to_robot" title="Permalink to this definition"></a></dt>
<dd><p>Start processing text from the user. This handles sanitation of the strings and
any special commands that affect the conversation flow rather than the action (like aborting etc)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>text</strong> – what the user typed or said</p>
</dd>
</dl>
<p>:type text str</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationEngine._handle_special_commands">
<span class="sig-name descname"><span class="pre">_handle_special_commands</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">text</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#conversation_engine.engine.ConversationEngine._handle_special_commands" title="Permalink to this definition"></a></dt>
<dd><p>Check for special commands that should not be parsed further</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>indicating if the text is a special command</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3.8/library/functions.html#bool" title="(in Python v3.8)">bool</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationEngine._stop">
<span class="sig-name descname"><span class="pre">_stop</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#conversation_engine.engine.ConversationEngine._stop" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationEngine._start_new_conversation">
<span class="sig-name descname"><span class="pre">_start_new_conversation</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#conversation_engine.engine.ConversationEngine._start_new_conversation" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationEngine._handle_command">
<span class="sig-name descname"><span class="pre">_handle_command</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">text</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#conversation_engine.engine.ConversationEngine._handle_command" title="Permalink to this definition"></a></dt>
<dd><p>Parse text into goal semantics, send to action_server</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationEngine._handle_additional_info">
<span class="sig-name descname"><span class="pre">_handle_additional_info</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">text</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#conversation_engine.engine.ConversationEngine._handle_additional_info" title="Permalink to this definition"></a></dt>
<dd><p>Parse text into additional info according to grammar &amp; target received from action_server result</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationEngine._handle_user_while_waiting_for_robot">
<span class="sig-name descname"><span class="pre">_handle_user_while_waiting_for_robot</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">text</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#conversation_engine.engine.ConversationEngine._handle_user_while_waiting_for_robot" title="Permalink to this definition"></a></dt>
<dd><p>Talk with the user while the robot is busy doing stuff</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationEngine._handle_user_while_aborting">
<span class="sig-name descname"><span class="pre">_handle_user_while_aborting</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">text</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#conversation_engine.engine.ConversationEngine._handle_user_while_aborting" title="Permalink to this definition"></a></dt>
<dd><p>Talk with the user while the robot is busy aborting the action</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationEngine._say_ready_for_command">
<span class="sig-name descname"><span class="pre">_say_ready_for_command</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#conversation_engine.engine.ConversationEngine._say_ready_for_command" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationEngine._done_cb">
<span class="sig-name descname"><span class="pre">_done_cb</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">task_outcome</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#conversation_engine.engine.ConversationEngine._done_cb" title="Permalink to this definition"></a></dt>
<dd><p>The action_server’s action is done, which can mean the action is finished (successfully or failed) or
needs additional info. This last option is handled by _on_request_missing_information and
the other cases by a starting a new conversation</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationEngine._feedback_cb">
<span class="sig-name descname"><span class="pre">_feedback_cb</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feedback</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#conversation_engine.engine.ConversationEngine._feedback_cb" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationEngine._get_grammar_target">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">_get_grammar_target</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">missing_field_path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#conversation_engine.engine.ConversationEngine._get_grammar_target" title="Permalink to this definition"></a></dt>
<dd><p>Determine which grammar target to use when a particular field of info is missing.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationEngine._log_invalid_command">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">_log_invalid_command</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">text</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#conversation_engine.engine.ConversationEngine._log_invalid_command" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationEngine._say_to_user">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">_say_to_user</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#conversation_engine.engine.ConversationEngine._say_to_user" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationEngine._on_task_successful">
<span class="sig-name descname"><span class="pre">_on_task_successful</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#conversation_engine.engine.ConversationEngine._on_task_successful" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationEngine._on_request_missing_information">
<span class="sig-name descname"><span class="pre">_on_request_missing_information</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">description</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grammar</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#conversation_engine.engine.ConversationEngine._on_request_missing_information" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationEngine._on_task_outcome_failed">
<span class="sig-name descname"><span class="pre">_on_task_outcome_failed</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#conversation_engine.engine.ConversationEngine._on_task_outcome_failed" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationEngine._on_task_outcome_unknown">
<span class="sig-name descname"><span class="pre">_on_task_outcome_unknown</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#conversation_engine.engine.ConversationEngine._on_task_outcome_unknown" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationEngine._start_wait_for_command">
<span class="sig-name descname"><span class="pre">_start_wait_for_command</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">grammar</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#conversation_engine.engine.ConversationEngine._start_wait_for_command" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationEngine.is_text_valid_input">
<span class="sig-name descname"><span class="pre">is_text_valid_input</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">text</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#conversation_engine.engine.ConversationEngine.is_text_valid_input" title="Permalink to this definition"></a></dt>
<dd><p>Checks if the provided text input is valid by parsing it</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>text</strong> (<a class="reference external" href="https://docs.python.org/3.8/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – input text</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>whether the parsing succeeded or failed</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3.8/library/functions.html#bool" title="(in Python v3.8)">bool</a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationEngineUsingTopic">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">conversation_engine.engine.</span></span><span class="sig-name descname"><span class="pre">ConversationEngineUsingTopic</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">robot_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grammar</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">command_target</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#conversation_engine.engine.ConversationEngineUsingTopic" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#conversation_engine.engine.ConversationEngine" title="conversation_engine.engine.ConversationEngine"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ConversationEngine</span></code></a></p>
<p>ConversationEngine provides the bridge between the user and the action_server.</p>
<p>It accepts text and parses it to a ‘semantics’ dictionary that the action_server can interpret.</p>
<p>The action_server then tries to formulate a plan based on the semantics and either:
- starts execution and succeeds or fails
- indicates it is missing information.
In the case of missing information, the action_server indicates what field of information it is missing.</p>
<p>Based on that, the ConversationEngine must converse with the user to obtain more information.
There is some logic to determine with grammar rules/target to use to parse the additional information with.</p>
<p>Once the information is obtained, the semantics of the current conversation state are updated
and sent to the action_server again, in hope the semantics is now complete enough for execution.</p>
<p>ConversationEngine is set up as a base class, that leaves the implementation of talking with the user to subclasses.
Implement
- _say_to_user to say something to the user
- user_to_robot_text to accept text from the user</p>
<p>Initialize a new ConversationEngine for the given robot, using some grammar with a command_target.
Indicate whether to give examples of thins to say to the user via give_examples</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>action_client</strong> (<em>Client</em>) – interface to the action server</p></li>
<li><p><strong>grammar</strong> (<a class="reference external" href="https://docs.python.org/3.8/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – <p>string to initialize a CFGParser with see <a class="reference external" href="https://github.com/tue-robotics/grammar_parser/">https://github.com/tue-robotics/grammar_parser/</a>
The grammar must result in an action description dictionary, like
{‘actions’: [{‘action’: ‘hand-over’,</p>
<blockquote>
<div><p>’object’: {‘type’: ‘drink’},
‘target-location’: {‘type’: ‘person’, ‘id’: ‘operator’}}]}</p>
</div></blockquote>
</p></li>
<li><p><strong>command_target</strong> (<a class="reference external" href="https://docs.python.org/3.8/library/stdtypes.html#str" title="(in Python v3.8)"><em>str</em></a>) – the root of the grammar’s parse tree</p></li>
<li><p><strong>give_examples</strong> (<a class="reference external" href="https://docs.python.org/3.8/library/functions.html#bool" title="(in Python v3.8)"><em>bool</em></a>) – Include examples when talking with the user.
These are randomly generated from the active part of the grammar</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationEngineUsingTopic._user_to_robot_sub">
<span class="sig-name descname"><span class="pre">_user_to_robot_sub</span></span><a class="headerlink" href="#conversation_engine.engine.ConversationEngineUsingTopic._user_to_robot_sub" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationEngineUsingTopic._robot_to_user_pub">
<span class="sig-name descname"><span class="pre">_robot_to_user_pub</span></span><a class="headerlink" href="#conversation_engine.engine.ConversationEngineUsingTopic._robot_to_user_pub" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationEngineUsingTopic.user_to_robot_msg">
<span class="sig-name descname"><span class="pre">user_to_robot_msg</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">msg</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#conversation_engine.engine.ConversationEngineUsingTopic.user_to_robot_msg" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="conversation_engine.engine.ConversationEngineUsingTopic._say_to_user">
<span class="sig-name descname"><span class="pre">_say_to_user</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#conversation_engine.engine.ConversationEngineUsingTopic._say_to_user" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../index.html" class="btn btn-neutral float-left" title="conversation_engine" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, tue-robotics.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>